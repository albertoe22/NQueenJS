<!DOCTYPE html>

<html>

    <head>
        <link rel="stylesheet" href = "style.css">
        <link href="https://fonts.googleapis.com/css?family=Noto+Sans+JP:300,500&display=swap" rel="stylesheet">
        <title>NQueen</title>
    </head>
    <body>
        <header>NQueen</header>
        <h1>by Albert Truong</h1>
        <button onclick = "reset()">Reset</button>
        <button onclick = "changeGrid()">Grid Size</button>
        <div id ="container"></div>
    </body>

    <script>
    var n = 4;
    var board = [];
    var myVar;
    var arr = [];
    var position = {
        square: "",
        color:""

    };
    var key = 0;
    var f = 0;

    function createBoard(size) {
        for (var i = 0; i < size; i++) {
            board[i] = [];
            var row = document.createElement("div");
            row.className = "row";
            for (var j = 0; j < size; j++) {
                board[i][j] = 0;
                var div = document.createElement("div");
                div.className = "square";
                var x = "square" + j + i;
                div.id = x;

                div.style.width = 500/size + "px";
                div.style.height = 500/size + "px";
                row.appendChild(div);
                
                
            }
            document.getElementById("container").appendChild(row);
        }

        for (var i = 0; i < size; i++) {
            for (var j = 0; j< size; j ++) {
                if ((i + j-1) % 2 == 0) { 
                var square = "square" + i + j;
                document.getElementById(square).style.background = "rgb(0,0,0)";
                }
            }
        }
    }

    // Method checks if given queen position is valid by checking previous rows and diagonals
    // col = x; row = y
    function isValid(row, col) {
        let i, j;
        
        for (i = 0; i < col; i++) {
            if (board[row][i] == 1) {
                return false;
            }
        }
        // upper diagonal
        for (i = row, j = col; i >= 0  && j >= 0; i--, j--) {
            if (board[i][j] == 1) {
                return false;
            }
        }
        // lower diagonal
        for (i = row,  j = col; j >=0 && i < n; j--, i++) {
            if (board[i][j] == 1) {
                return false;
            }
        }
        return true;
    }

    function myFunction(num) {
        var name = arr[num].square;
        var color = arr[num].color;
        document.getElementById(name).style.background = color;
        if (num < arr.length-1) setTimeout(function(){myFunction(num+1)}, 1000);
    }
    
    function NQueen(col) {
        if (col == n) {
            return true;
        }
        // Checks if given move is valid for all positions in the column
        for (var i = 0; i < n; i++) {
            let square = "square" + i + col;
            let originalColor = document.getElementById(square).style.background;
            var x = {square: square, color: "rgb(255,0,0)"};
            arr[key] =x;
            key++;
            if (isValid(i,col)) {
                board[i][col] = 1;
                if (NQueen(col+1)) { 
                    requestAnimationFrame(NQueen);   
                    return true;
                }

                x = {square: square, color: originalColor};
                arr[key] = x;
                key++;
                board[i][col] = 0;

            }
            x = {square: square, color: originalColor};
                arr[key] = x;
                key++;
                board[i][col] = 0;
        }
        return false;
    }


    //setTimeout(function() {myFunction(square, color)}, 2000);
    //setTimeout(myFunction, 2000, square, color);
    //setTimeout(function() {document.getElementById("square" + i + col).style.background = color}, 2000);


    createBoard(n);
    if (NQueen(0)){
        console.log("Solved");
        console.log(arr.length);
        myFunction(0);
    }


    </script>


</html>